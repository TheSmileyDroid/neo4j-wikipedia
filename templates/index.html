<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>ONGDB Wikipedia Graph</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- vis-network for graph visualization -->
    <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" type="text/css" />
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="/static/style.css" rel="stylesheet">
</head>
<body>
    <div class="mt-5 mx-3">
        <div class="text-center mb-4">
            <h1 class="display-4 text-primary">ONGDB Wikipedia Graph</h1>
        </div>

        <!-- Busca de páginas -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Buscar Páginas</h5>
            </div>
            <div class="card-body">
                <form id="search-form" class="row g-3">
                    <div class="col-md-6">
                        <input type="text" class="form-control" id="search-input" placeholder="Buscar página..." required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">&nbsp;</label>
                        <button type="submit" class="btn btn-primary">Buscar</button>
                    </div>
                    <div class="col-md-2">
                        <label for="node-limit" class="form-label">Limite de nós</label>
                        <input type="number" class="form-control" id="node-limit" min="10" max="200" value="50" placeholder="50">
                    </div>
                </form>
            </div>
        </div>

        <!-- Caminho mais curto -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Caminho Mais Curto</h5>
            </div>
            <div class="card-body">
                <form id="shortest-path-form" class="row g-3">
                    <div class="col-md-5">
                        <input type="text" class="form-control" id="source-input" placeholder="Página origem..." required>
                    </div>
                    <div class="col-md-5">
                        <input type="text" class="form-control" id="target-input" placeholder="Página destino..." required>
                    </div>
                    <div class="col-md-2 d-flex align-items-center">
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" id="undirected-input">
                            <label class="form-check-label" for="undirected-input">
                                Não-direcionado
                            </label>
                        </div>
                        <button type="submit" class="btn btn-success">Buscar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Resultados da busca -->
        <div id="results" class="mb-4"></div>

        <!-- Visualização do grafo -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Visualização do Grafo</h5>
            </div>
            <div class="card-body p-0">
                <div id="graph" style="height: 500px;"></div>
            </div>
        </div>
    </div>
    <script>
    // Search and show results
    document.getElementById('search-form').onsubmit = async function(e) {
        e.preventDefault();
        const q = document.getElementById('search-input').value;
        const res = await fetch(`/search?q=${encodeURIComponent(q)}`);
        const data = await res.json();
        let html = '<div class="list-group">';
        data.forEach(item => {
            html += `<a href="#" class="list-group-item list-group-item-action" onclick="loadGraph('${item.title.replace(/'/g, "\\'")}')">${item.title}</a>`;
        });
        html += '</div>';
        document.getElementById('results').innerHTML = html;
    };

    // Load and show graph
    async function loadGraph(page) {
        const nodeLimit = document.getElementById('node-limit').value || 50;
        const res = await fetch(`/graph?page=${encodeURIComponent(page)}&limit=${nodeLimit}`);
        if (!res.ok) {
            alert('Página não encontrada!');
            return;
        }
        const data = await res.json();
        const container = document.getElementById('graph');
        const options = {
            nodes: { shape: 'dot', size: 20, font: { size: 16 } },
            edges: { arrows: 'to', color: '#888' },
            groups: {
                1: { color: { background: '#007bff', border: '#0056b3' } },
                2: { color: { background: '#28a745', border: '#1e7e34' } },
                3: { color: { background: '#ffc107', border: '#d39e00' } }
            },
            physics: {
                stabilization: true,
            },
        };
        const network = new vis.Network(container, data, options);
    }
    // Shortest path form
    document.getElementById('shortest-path-form').onsubmit = async function(e) {
        e.preventDefault();
        const source = document.getElementById('source-input').value;
        const target = document.getElementById('target-input').value;
        const undirected = document.getElementById('undirected-input').checked;
        const res = await fetch(`/shortest_path?source=${encodeURIComponent(source)}&target=${encodeURIComponent(target)}&undirected=${undirected ? '1' : '0'}`);
        if (!res.ok) {
            alert('Caminho não encontrado!');
            return;
        }
        const data = await res.json();
        const container = document.getElementById('graph');
        const options = {
            nodes: { shape: 'dot', size: 20, font: { size: 16 } },
            edges: { arrows: 'to', color: '#e83e8c', width: 3 },
            groups: {
                1: { color: { background: '#fd7e14', border: '#c66900' } },
                2: { color: { background: '#6f42c1', border: '#4e2a8e' } }
            },
            physics: { stabilization: true }
        };
        new vis.Network(container, data, options);
    };
    </script>
</body>
</html>
